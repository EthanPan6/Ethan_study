"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function SelfVue(t){var e=this;this.data=t.data,this.methods=t.methods,Object.keys(this.data).forEach(function(t){e.proxyKeys(t)}),observe(this.data),new Compile(t.el,this),t.mounted.call(this)}function Observer(t){this.data=t,this.walk(t)}function Dep(){this.subs=[]}function observe(t,e){if(t&&"object"===_typeof(t))return new Observer(t)}function Watcher(t,e,n){this.cb=n,this.vm=t,this.exp=e,this.value=this.get()}function Compile(t,e){this.vm=e,this.el=document.querySelector(t),this.fragment=null,this.init()}SelfVue.prototype={proxyKeys:function(e){var n=this;Object.defineProperty(this,e,{enumerable:!1,configurable:!0,get:function(){return n.data[e]},set:function(t){n.data[e]=t}})}},Observer.prototype={walk:function(e){var n=this;Object.keys(e).forEach(function(t){n.defineReactive(e,t,e[t])})},defineReactive:function(t,e,n){var i=new Dep;observe(n);Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){return Dep.target&&i.addSub(Dep.target),n},set:function(t){t!==n&&(n=t,i.notify())}})}},Dep.prototype={addSub:function(t){this.subs.push(t)},notify:function(){this.subs.forEach(function(t){t.update()})}},Dep.target=null,Watcher.prototype={update:function(){this.run()},run:function(){var t=this.vm.data[this.exp],e=this.value;t!==e&&(this.value=t,this.cb.call(this.vm,t,e))},get:function(){var t=(Dep.target=this).vm.data[this.exp];return Dep.target=null,t}},Compile.prototype={init:function(){this.el?(this.fragment=this.nodeToFragment(this.el),this.compileElement(this.fragment),this.el.appendChild(this.fragment)):console.log("Dom元素不存在")},nodeToFragment:function(t){for(var e=document.createDocumentFragment(),n=t.firstChild;n;)e.appendChild(n),n=t.firstChild;return e},compileElement:function(t){var e=t.childNodes,i=this;[].slice.call(e).forEach(function(t){var e=/\{\{(.*)\}\}/,n=t.textContent;i.isElementNode(t)?i.compile(t):i.isTextNode(t)&&e.test(n)&&i.compileText(t,e.exec(n)[1]),t.childNodes&&t.childNodes.length&&i.compileElement(t)})},compile:function(o){var t=o.attributes,r=this;Array.prototype.forEach.call(t,function(t){var e,n,i=t.name;r.isDirective(i)&&(e=t.value,n=i.substring(2),r.isEventDirective(n)?r.compileEvent(o,r.vm,e,n):r.compileModel(o,r.vm,e,n),o.removeAttribute(i))})},compileText:function(e,t){var n=this,i=this.vm[t];this.updateText(e,i),new Watcher(this.vm,t,function(t){n.updateText(e,t)})},compileEvent:function(t,e,n,i){var o=i.split(":")[1],r=e.methods&&e.methods[n];o&&r&&t.addEventListener(o,r.bind(e),!1)},compileModel:function(e,t,n){var i=this,o=this.vm[n];this.modelUpdater(e,o),new Watcher(this.vm,n,function(t){i.modelUpdater(e,t)}),e.addEventListener("input",function(t){var e=t.target.value;o!==e&&(i.vm[n]=e,o=e)})},updateText:function(t,e){t.textContent=void 0===e?"":e},modelUpdater:function(t,e){t.value=void 0===e?"":e},isDirective:function(t){return 0==t.indexOf("v-")},isEventDirective:function(t){return 0===t.indexOf("on:")},isElementNode:function(t){return 1==t.nodeType},isTextNode:function(t){return 3==t.nodeType}};